<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Generalized multi-quickselect</title>
  <meta name="description" content="I’ve been thinking a lot recently about how you find the $l k$th smallest element in the disjoint union of several data structures.">


  <link rel="stylesheet" href="/bootstrap.css">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://shlegeris.com/2016/06/16/generalized-multi-quickselect.html">
  <link rel="alternate" type="application/rss+xml" title="Buck Shlegeris" href="http://shlegeris.com/feed.xml">
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      jax: ["input/TeX", "output/HTML-CSS"],
      tex2jax: {
        inlineMath: [ ['$l', '$'] ],
        displayMath: [ ['$$', '$$']],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      },
      messageStyle: "none",
      "HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"] }
    });
  </script>
  <script src='https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>
  <script src="/jquery.js"></script>
  <script type="text/babel" src="/main.js"></script>
  
</head>


  <body>

    

    <div class="container">
  <div class="row">
    <div class="col-sm-7 col-sm-offset-1 markdownify">
      <h1 class="post-title " itemprop="name headline">Generalized multi-quickselect</h1>
      <p class="post-meta"><time datetime="2016-06-16T00:00:00-07:00" itemprop="datePublished">Jun 16, 2016</time></p>

      <hr/>

      <p>I’ve been thinking a lot recently about how you find the $l k$th smallest element in the disjoint union of several data structures.</p>

<h2 id="multi-quickselect-on-data-structures-with-fast-rank">Multi-quickselect on data structures with fast <code class="highlighter-rouge">rank</code></h2>

<p>Yesterday I <a href="/2016/06/15/multi-sorted-array-quickselect">came up with an algorithm similar to quickselect</a> for the version of this problem where you have multiple sorted arrays.</p>

<p>But this algorithm also works on any other data structure which supports the <code class="highlighter-rouge">rank</code> method in $l O(\log(n))$ time.</p>

<p>On a collection of data structures with a total of $l O(t)$ elements, the modified quickselect algorithm involves $l O(log(t))$ iterations. In each iteration, the rank of a random element is computed in every data structure.</p>

<p>So the total time taken is (time to calculate rank in every data structure) * (log of total number of elements).</p>

<table class="table" id="table1">
  <tr>
    <th>Collection</th>
    <th>Time complexity</th>
  </tr>
  <tr>
    <td>$l m$ sorted arrays of average length $l n$</td>
    <td>$l \log(m \cdot n) \cdot m \cdot \log(n)$</td>
  </tr>
    <tr>
    <td>$l m$ sorted arrays of total length $l t$</td>
    <td>$l \log(t) \cdot m \cdot \log(\frac tm)$</td>
  </tr>
  <tr>
    <td>Two sorted arrays, of lengths $l a$ and $l b$</td>
    <td>$l \log(a + b)^2$</td>
  </tr>
  <tr>
    <td>$l m$ order statistic trees of average size $l n$</td>
    <td>$l \log(m \cdot n) \cdot m \cdot \log(n)$</td>
  </tr>
  <tr>
    <td>$l \log(n)$ sorted arrays of sizes $l [1, 2, 4, ...n]$</td>
    <td>$l \log(n)^3$ </td>
  </tr>
</table>

<p>(See <sup id="fnref:1"><a href="#fn:1" class="footnote">1</a></sup> for more details on the exponentially shrinking arrays.)</p>

<p>For data structures with $l O(log(n))$ <code class="highlighter-rouge">rank</code>, I think this is optimal.</p>

<h2 id="allowing-data-structures-without-fast-rank">Allowing data structures without fast <code class="highlighter-rouge">rank</code></h2>

<p>How about if some of your data structures are unsorted?</p>

<p>This algorithm needs to be modified, because there’s no particular guarantee that any data structure gets smaller on a particular iteration. This is okay in cases where <code class="highlighter-rouge">rank</code> is cheap enough that the asymptotic complexity isn’t affected by having a data structure which stays at its original size for most of the runtime of the algorithm. But on an unsorted array, <code class="highlighter-rouge">rank</code> takes $l O(n)$ and a key part of the argument for the good runtime of quickselect is that the unordered array usually gets smaller every time you call <code class="highlighter-rouge">rank</code>.</p>

<p>This issue is why my attempt at an <a href="/2016/06/12/quickselect-lemma.html">optimal algorithm for selection on an OST and an unsorted array</a> was so complex.</p>

<p>Obviously there’s not going to be a sublinear time solution to this problem. So we might as well take linear time to add all our unsorted structures together into an unsorted array, in linear time. So we only need to consider the problem where we have a single unsorted array.</p>

<h3 id="non-optimal-solution">Non-optimal solution</h3>

<p>When I have a collection of data structures such that <code class="highlighter-rouge">rank</code> takes time $l O(r)$ and <code class="highlighter-rouge">select</code> takes time $l O(s)$, I can run <a href="/2016/06/12/quickselect-lemma.html">my <code class="highlighter-rouge">double_quickselect_v2</code> algorithm</a> on an unordered array of length $l n$ and that collection, with query time $l O(\log(n) \cdot r + s)$. For example, this algorithm can deal with a sorted array of size $l m$ and an unsorted array of size $l n$ in overall $l O(\log(n) \cdot \log(m) + \log(m)) = O(\log(m)\cdot\log(n))$.</p>

<h3 id="what-an-optimal-solution-might-look-like">What an optimal solution might look like</h3>

<p>I bet we can generalize my alleged <a href="/2016/06/12/quickselect-lemma.html">optimal algorithm for selection on an OST and an unsorted array</a>.</p>

<h2 id="summary">Summary</h2>

<p>I have a bunch of data structures and want to find the $l k$th smallest item in their union. How long will it take me?</p>

<table class="table" id="table1">
  <tr>
    <th>Collection</th>
    <th>Algorithm</th>
    <th>Time complexity</th>
  </tr>
  <tr>
    <td>Unsorted array of size $l n$</td>
    <td>Median of medians</td>
    <td>Worst case $l O(n)$</td>
  </tr>
  <tr>
    <td>Sorted array of size $l n$</td>
    <td>Binary search</td>
    <td>Worst case $l O(\log(n))$</td>
  </tr>
  <tr>
    <td>Order statistic tree</td>
    <td>its native `find` implementation</td>
    <td>Worst case $l O(\log(n))$</td>
  </tr>
  <tr>
    <td>A bunch of unsorted data structures, of total size $l O(n)$</td>
    <td>Stick it all in an array then call median of medians</td>
    <td>Worst case $l O(\log(n))$</td>
  </tr>
  <tr>
    <td>$l m$ data structures which support <code>rank</code> in $l O(\log(n))$, with maximum size $l O(n)$</td>
    <td><a href="/2016/06/15/multi-sorted-array-quickselect.html">Multi sorted array quickselect</a></td>
    <td>Average case $l O(m \cdot \log(n) \cdot \log(m \cdot n))$</td>
  </tr>
  <tr>
    <td>$l m$ data structures which support <code>rank</code> in $l O(\log(n))$, with maximum size $l O(n)$, and also a bunch of unsorted data with total size $l u$</td>
    <td>"Non-optimal solution" as described above</td>
    <td>Average case $l O(\log(u) \cdot m \cdot \log(n) +\\ m \cdot \log(n) \cdot \log(m \cdot n))$</td>
  </tr>
</table>

<p>I suspect that I can improve upon most of the algorithms listed there that I invented myself; I’ll keep this table updated.</p>

<p>If you know a faster algorithm for one of these problems, please let me know!</p>

<div class="footnotes">
  <ol>
    <li id="fn:1">

      <p>There are a total of $l 2\cdot n - 1 = O(n)$ elements in those $l n$ arrays. The inner loop will happen $l \log(n)$ times.</p>

      <p>Each iteration will need to do a binary search within its array. On the first iteration the time taken will be $l \sum_{i=0}^{\log(n)} \log(2^i) = O(\log(n)^2)$. Further iterations obviously won’t be slower than that. So we can bound above this runtime by $l \log(n)$.</p>

      <p>We can also give a proof sketch for bounding it below. Suppose that all our arrays have roughly the same distribution, so that on the $l w$th iteration, every array has a size of only $l 2^{-w}$ its original size.</p>

      <script type="math/tex; mode=display">% <![CDATA[
\begin{align} &\sum_{w=0}^{\log(n)} \sum_{i=0}^{\log(n)} \log\left(max\left(2^i \cdot 2^{-w}, 0\right)\right)  \\
        = &\sum_{w=0}^{\log(n)} \sum_{i=0}^{w} i  \\
        = &\sum_{w=0}^{\log(n)} O\left( w^2 \right) \\
        = &O\left(\log(n)^3\right) \end{align} %]]></script>
      <p><a href="#fnref:1" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>


      <hr/>

<div class="PageNavigation">
  
    <a class="prev" href="/2016/06/15/multi-sorted-array-quickselect.html">&laquo; Quickselect on multiple sorted arrays</a>
  
  
    <a class="pull-right" href="/2016/06/16/kth-richest.html">A data structure for range kth-smallest queries &raquo;</a>
  
</div>

    </div>
    <div class="col-sm-3 col-sm-offset-1">
      <img src="https://scontent-sjc2-1.xx.fbcdn.net/hphotos-xtp1/t31.0-8/11154688_10205041372168719_3725604149367069581_o.jpg" class="img-responsive" alt="Picture of Buck">
      
<hr/>
<a class="arrow" href="/"><strong>Buck</strong></a>
<ul>
  <li><a class="arrow" href="/about">About</a>
    <ul>
      <li><a href="http://triplebyte.com?ref=shlegeris.com">Triplebyte</a></li>
    </ul>
  </li>
  <li>Links
    <ul>
      <li>
          <a class="arrow" href="http://github.com/bshlgrs">GitHub</a>
      </li>
      <li>
          <a class="arrow" href="mailto:bshlegeris@gmail.com">Email</a>
      </li>
      <li>
          <a class="arrow" href="http://www.facebook.com/bshlgrs">Facebook</a>
      </li>
      <li>
          <a class="arrow" href="http://lnkd.in/bnBJ6EF">LinkedIn</a>
      </li>
    </ul>
  </li>
  <li><a class="arrow external" href="/anonymous_feedback">Anonymous feedback</a></li>
  <li>Software to play with
    <ul>
      <li>
          <a class="arrow" href="https://bshlgrs.github.io/music-game/">Relative pitch game</a>
      </li>
      <li>
          <a class="arrow" href="http://shlegeris.com/gini">Gini coefficient tool</a>
      </li>
    </ul>
  </li>
  <li><a href="/posts" class="arrow">Blog</a> (<a href="/best" class="arrow">Best posts</a>)
    <ul>
      
        <li>
          <a class="arrow" href="/2016/09/03/tax-percentiles.html">Should we encourage price discrimination based on income?</a>
        </li>
      
        <li>
          <a class="arrow" href="/2016/09/03/printers.html">Printers and price discrimination</a>
        </li>
      
        <li>
          <a class="arrow" href="/2016/08/30/white-dudes.html">Privilege and polite disagreement</a>
        </li>
      
        <li>
          <a class="arrow" href="/2016/08/24/armchair.html">The Armchair Economist on moral philosophy</a>
        </li>
      
        <li>
          <a class="arrow" href="/2016/08/16/dumb.html">Dumb ideas</a>
        </li>
      
        <li>
          <a class="arrow" href="/2016/08/14/formatting.html">Using formatting in writing</a>
        </li>
      
        <li>
          <a class="arrow" href="/2016/08/14/bootcamp-attendees.html">My advice to people about to attend bootcamps</a>
        </li>
      
        <li>
          <a class="arrow" href="/2016/08/14/algorithms.html">My advice on studying algorithms</a>
        </li>
      
    </ul>
  </li>
  <li>
      <a class="arrow" href="/cute">Pictures of me</a>
  </li>
</ul>

    </div>
  </div>
</div>




    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">Buck Shlegeris</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>Buck Shlegeris</li>
          <li><a href="mailto:bshlegeris@gmail.com">bshlegeris@gmail.com</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/bshlgrs"><span class="icon icon--github"><svg viewBox="0 0 16 16"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">bshlgrs</span></a>

          </li>
          

          
          <li>
            <a href="https://twitter.com/bshlgrs"><span class="icon icon--twitter"><svg viewBox="0 0 16 16"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg>
</span><span class="username">bshlgrs</span></a>

          </li>
          
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>Website of Buck Shlegeris.
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

<script>
if (window.location.hostname == "bshlgrs.github.io") {
  window.location.hostname = "shlegeris.com";
}
</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-52980069-1', 'auto');
  ga('send', 'pageview');

</script>



</html>

