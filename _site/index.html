<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Buck Shlegeris</title>
  <meta name="description" content="Website of Buck Shlegeris.
">


  <link rel="stylesheet" href="/bootstrap.css">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://shlegeris.com/">
  <link rel="alternate" type="application/rss+xml" title="Buck Shlegeris" href="http://shlegeris.com/feed.xml">
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      jax: ["input/TeX", "output/HTML-CSS"],
      tex2jax: {
        inlineMath: [ ['$$', '$$'] ],
        displayMath: [ ['$^$', '$^$']],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      },
      messageStyle: "none",
      "HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"] }
    });
  </script>
  <script src='https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>
  <script src="/jquery.js"></script>
  <script type="text/babel" src="/main.js"></script>
  
</head>


  <body>

    

    <div class="container">
  <div class="row">
    <div class="col-sm-3 hidden-xs">
      <img src="/img/dual_n_buck.jpeg" class="img-responsive" alt="Picture of Buck" height="213" width="213">
<hr/>
<a class="arrow" href="/"><strong>Buck</strong></a>
<ul>
  <li><a class="arrow" href="/about">About</a>
    <ul>
      <li><a href="http://triplebyte.com?ref=shlegeris.com">Triplebyte</a></li>
    </ul>
  </li>
  <li>Links
    <ul>
      <li>
          <a class="arrow" href="http://github.com/bshlgrs">GitHub</a>
      </li>
      <li>
          <a class="arrow" href="mailto:bshlegeris@gmail.com">Email</a>
      </li>
      <li>
          <a class="arrow" href="http://www.facebook.com/bshlgrs">Facebook</a>
      </li>
      <li>
          <a class="arrow" href="http://lnkd.in/bnBJ6EF">LinkedIn</a>
      </li>
    </ul>
  </li>
  <li><a class="arrow external" href="/anonymous_feedback">Anonymous feedback</a></li>
  <li>Software to play with
    <ul>
      <li>
          <a class="arrow" href="https://bshlgrs.github.io/music-game/">Relative pitch game</a>
      </li>
      <li>
          <a class="arrow" href="http://shlegeris.com/gini">Gini coefficient tool</a>
      </li>
      <li>
          <a class="arrow" href="http://shlegeris.com/dice">Extremely serious election probability tool</a>
      </li>
    </ul>
  </li>
  <li><a href="/posts" class="arrow">Blog</a> (<a href="/best" class="arrow">Best posts</a>) (<a href="/feed.xml">RSS</a>)
    <ul>
      
        <li>
          <a class="arrow" href="/2016/11/13/ds.html">Building a search engine for data structures</a>
        </li>
      
        <li>
          <a class="arrow" href="/2016/10/23/poor-college-graduates.html">Poor college graduates do much better than rich high-school dropouts</a>
        </li>
      
        <li>
          <a class="arrow" href="/2016/10/20/libertarians.html">Left-libertarianism</a>
        </li>
      
        <li>
          <a class="arrow" href="/2016/10/07/optimal-tax.html">Optimal redistribution with a flat tax</a>
        </li>
      
        <li>
          <a class="arrow" href="/2016/10/02/ubi.html">Universal basic incomes disincentivise work</a>
        </li>
      
        <li>
          <a class="arrow" href="/2016/10/02/tax.html">The great thing about regressive taxes</a>
        </li>
      
        <li>
          <a class="arrow" href="/2016/09/27/wages.html">Contradictory claims in labor economics</a>
        </li>
      
        <li>
          <a class="arrow" href="/2016/09/24/cato.html">A mistake in the Cato institute report on risks from refugees</a>
        </li>
      
    </ul>
  </li>
  <li>
      <a class="arrow" href="/to-prove-list">My "to-prove" list</a>
  </li>
  <li>
      <a class="arrow" href="/mistakes">Mistakes</a>
  </li>
  <li>
      <a class="arrow" href="/cute">Pictures of me</a>
  </li>
</ul>

    </div>

    <div class="col-sm-7 col-sm-offset-1 markdownify">
      
      <p class="post-meta"><time datetime="1969-12-31T16:00:00-08:00" itemprop="datePublished"></time></p>

      <hr/>

      <h1>Buck Shlegeris</h1>

<div class="lead">
<p>I am a software engineer from Australia. I have lived in San Francisco for most of the last three years. I'm interested in data structures, economics, and effective altruism.</p>
<p><a href="/best">Here</a> are the most interesting things I've written. My most notable software project is <a href="http://ds.shlegeris.com">a search engine for data structures</a>.</p>
<p>If, <a href="http://www.overcomingbias.com/2008/03/against-news.html">like many</a>, you prefer to consume content ordered by recency rather than quality, here are some things I wrote recently:</p>
</div>


  <div class="buck-post">
    <h2><a href="/2016/11/13/ds.html"> Building a search engine for data structures</a></h2>

    <p class="post-meta"><time datetime="2016-11-13T00:00:00-08:00" itemprop="datePublished">Nov 13, 2016</time></p>

    <div class="shrink-headings">
      <p>Today I <a href="https://scalaebythebay2016.sched.org/event/7iUk/automatic-composition-of-fast-data-structures">presented at Scala By The Bay</a> about my project to build a search engine for data structures. I’ve deployed the project at <a href="http://ds.shlegeris.com">ds.shlegeris.com</a>; you can play with it there. You can also read the source code <a href="https://github.com/bshlgrs/data-structure-composer">on Github</a>.</p>

<p>This blog post is a more detailed version of the talk I gave today.</p>

<h2 id="a-search-engine-for-data-structures">A search engine for data structures</h2>

<p>A data structure is a way of organizing data to efficiently support a particular API. So a data structure search engine is a program which takes an API and returns an efficient implementation.</p>

<p>Let’s look at some examples of queries that the search engine is able to support. Here’s one from Cracking the Coding Interview:</p>

<p><img class="shadow-img" src="/img/sbtb/ctci.png" /></p>

<p>You can see the answer my software finds <a href="http://ds.shlegeris.com/#getLast,deleteLast!,insertLast!,getMinimum">here</a>.</p>

<p>Here’s one from Quora:</p>

<p><img class="shadow-img" src="/img/sbtb/quora1.png" /></p>

<p>And <a href="http://ds.shlegeris.com/#getMinimum,getMaximum,deleteMaximum!,deleteMinimum!,deleteFirstNodeWithValue!,insertAnywhere!">here’s my answer</a>.</p>

<p>Here’s a third Quora question:</p>

<p><img class="shadow-img" src="/img/sbtb/quora2.png" /></p>

<p><a href="http://ds.shlegeris.com/#getFirst,deleteFirst!,insertLast!,deleteAtIndex!">And my answer.</a>.</p>

<p>The pattern here is that we are being asked to choose a fast data structure to support a given set of methods. I’m going to call that set of methods an <a href="https://en.wikipedia.org/wiki/Abstract_data_type">abstract data type</a>, or ADT for short.</p>

<h2 id="implementation">Implementation</h2>

<p>The whole project is built around a bank of knowledge about data structures and the relationships between different methods.</p>

<p>The core algorithm is something like the following pseudocode:</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="n">chooseFastDataStructuresForAdt</span><span class="o">(</span><span class="n">adt</span><span class="k">:</span> <span class="kt">AbstractDataType</span><span class="o">)</span><span class="k">:</span> <span class="kt">Set</span><span class="o">[</span><span class="kt">DataStructureChoice</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">options</span><span class="k">:</span> <span class="kt">Set</span><span class="o">[</span><span class="kt">DataStructureChoice</span><span class="o">]</span> <span class="k">=</span>
    <span class="n">allDataStructures</span><span class="o">.</span><span class="n">subsets</span>
                     <span class="o">.</span><span class="n">map</span><span class="o">((</span><span class="n">subset</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">findAllTimes</span><span class="o">(</span><span class="n">subset</span><span class="o">,</span> <span class="n">adt</span><span class="o">))</span>

  <span class="n">adt</span><span class="o">.</span><span class="n">pickBestCompositeDataStructures</span><span class="o">(</span><span class="n">options</span><span class="o">)</span>
<span class="o">}</span>
</code></pre>
</div>

<p>So we compute the times taken for all the methods by each possible composite data structure. Then we choose the best data structures for our use case.</p>

<h3 id="aside-dominance-frontiers">Aside: Dominance frontiers</h3>

<p>One type that I use a lot in this code is what I’m calling a <code class="highlighter-rouge">DominanceFrontier</code>, for lack of a better name. A dominance frontier is a set of items <code class="highlighter-rouge">A</code> with a partial ordering on them, such that no item is strictly dominated by any other. For example, in the type of algebraic expressions with free variables <script type="math/tex">x</script> and <script type="math/tex">y</script> where our partial ordering is based on their asymptotic growth, I might have the set <script type="math/tex">\{x + y, x \log(x), y^2\}</script>, because no element is strictly less than any other. However, I couldn’t add <script type="math/tex">\{x\}</script> to that set, because it’s not asymptotically greater than <script type="math/tex">\{x + y\}</script>.</p>

<p><code class="highlighter-rouge">DominanceFrontier</code> is a monad over the category of partially ordered Scala objects (if you count Set as a monad). It’s a super useful abstraction over the idea of doing a search for the optimal solutions for some problem, and wanting to maintain all plausible subsolutions along the way.</p>

<h3 id="inference-on-method-implementations">Inference on method implementations</h3>

<p>To do this kind of inference, we need to be able to evaluate the runtimes of all methods of a particular composite data structure. Let’s look at how that works.</p>

<p>Throughout this whole thing I’m going to assume we’re talking about methods on an ordered list.</p>

<p>We need to talk about lots of different methods, like <code class="highlighter-rouge">getFirst</code>, <code class="highlighter-rouge">getNext</code>, <code class="highlighter-rouge">getByIndex</code>. These are redundant on purpose. In an array, it’s natural to define <code class="highlighter-rouge">getByIndex</code> and derive <code class="highlighter-rouge">getFirst</code> and <code class="highlighter-rouge">getNext</code> from that. In a linked list, the other way round is nicer.</p>

<p>We will describe the read methods of an ArrayList like this:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>ds ArrayList {
  getByIndex &lt;- 1
}
</code></pre>
</div>

<p>And a linked list will look like this:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>ds LinkedList {
  getNext &lt;- 1
  getFirst &lt;- 1
}
</code></pre>
</div>

<p>The central relationship that we care about is how implementations can be used to implement other things. Let’s make some rules like that:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>getByIndex &lt;- getFirst + n * getNext
getFirst &lt;- getByIndex
getNext &lt;- getByIndex
</code></pre>
</div>

<p>So you can implement <code class="highlighter-rouge">getByIndex</code> with O(1) calls to <code class="highlighter-rouge">getFirst</code> and O(n) calls to <code class="highlighter-rouge">getNext</code>. You can also implement <code class="highlighter-rouge">getFirst</code> or <code class="highlighter-rouge">getNext</code> with O(1) calls to <code class="highlighter-rouge">getByIndex</code>.</p>

<p>Facts of this type are called Impls in my system. Impls can either belong to data structures, like <code class="highlighter-rouge">getByIndex &lt;- 1</code> above, or they can be universally true, like <code class="highlighter-rouge">getByIndex &lt;- getFirst + n * getNext</code>.</p>

<h5 id="parameterization">Parameterization</h5>

<p>Additional complexity comes from the fact that Impls can be parameterized, and can have conditions attached to their parameters. For example, the method <code class="highlighter-rouge">reduce[f]</code> is parameterized by the function it’s reducing. The difference between a method being parameterized and it taking an argument is that the parameter must be known at the time of data structure initialization.</p>

<p>For example, if I want to have a list which maintains its sum, I can just store the sum as an Int somewhere, and add new values to my sum as they’re inserted and subtract them as they’re removed. This is possible because <code class="highlighter-rouge">+</code> is invertible. So I want to be able to write down a data structure for maintaining this kind of reduction. (simplified from <a href="https://github.com/bshlgrs/data-structure-composer/blob/d18a104400e214e589cefb72f8d466b97ae44c5f/data/data_structures/InvertibleReductionMemoizer.txt">here</a>)</p>

<div class="highlighter-rouge"><pre class="highlight"><code>ds InvertibleReductionMemoizer[f] if f.invertible {
    reduce[f] &lt;- 1
    insertLast! &lt;- 1
    deleteLast! &lt;- 1

    // you can do this anywhere if the
    insertAtIndex! if f.commutative &lt;- 1
    updateNode! if f.commutative &lt;- 1
    deleteNode! if f.commutative &lt;- 1
}
</code></pre>
</div>

<p>This data structure lets you push and pop values and maintains the reduction for any invertible function <code class="highlighter-rouge">f</code>. In addition, if <code class="highlighter-rouge">f</code> is commutative, you’re allowed to do random modifications to the list.</p>

<p>These constraints need to be propogated through the code. For example, my code contains these Impls</p>

<div class="highlighter-rouge"><pre class="highlight"><code>getMinimum &lt;- getFirstBy[valueOrdering]
getFirstBy[f] &lt;- reduce[_{commutative, idempotent} &lt;- f]
</code></pre>
</div>

<p>The <code class="highlighter-rouge">getFirstBy</code> Impl means that you can implement <code class="highlighter-rouge">getFirstBy[f]</code> by using <code class="highlighter-rouge">reduce</code> with a parameter which is commutative and idempotent, and which requires calling <code class="highlighter-rouge">f</code> every time it is called.</p>

<h4 id="searching-through-impls">Searching through Impls</h4>

<p>To search for method times for a given data structure, we start out by taking the union of all the Impls for a data structure and all the universal Impls, so in the case of the LinkedList above we have</p>

<div class="highlighter-rouge"><pre class="highlight"><code>getNext &lt;- 1
getFirst &lt;- 1
getByIndex &lt;- getFirst + n * getNext
getFirst &lt;- getByIndex
getNext &lt;- getByIndex
reduce[f] &lt;- getFirst + n * getNext + n * f
</code></pre>
</div>

<p>We want to end up with a map from methods to their final cost. To do this, we will basically graph search over our <code class="highlighter-rouge">Set[Impl]</code>. The code for that search looks something like this (real version <a href="https://github.com/bshlgrs/data-structure-composer/blob/cf5b29d5610cc7633ac86f40dabe697afef2f206/src/main/scala/implementationSearcher/Searcher.scala#L23-L68">here</a>):</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="n">getAllTimes</span><span class="o">(</span><span class="n">impls</span><span class="k">:</span> <span class="kt">Set</span><span class="o">[</span><span class="kt">Impl</span><span class="o">])</span><span class="k">:</span> <span class="kt">MethodTimes</span> <span class="o">=</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">result</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">MethodTimes</span><span class="o">()</span>
  <span class="k">val</span> <span class="n">queue</span> <span class="k">=</span> <span class="n">mutable</span><span class="o">.</span><span class="nc">PriorityQueue</span><span class="o">(</span><span class="n">impls</span><span class="o">.</span><span class="n">filter</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">hasNoFreeVariables</span><span class="o">))</span>

  <span class="k">while</span> <span class="o">(</span><span class="n">queue</span><span class="o">.</span><span class="n">nonEmpty</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">val</span> <span class="n">impl</span> <span class="k">=</span> <span class="n">queue</span><span class="o">.</span><span class="n">pop</span><span class="o">()</span>

    <span class="c1">// add impl to the result if it isn't already in there
</span>    <span class="k">if</span> <span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="n">implIsUseful</span><span class="o">(</span><span class="n">impl</span><span class="o">))</span> <span class="o">{</span>
      <span class="n">result</span><span class="o">.</span><span class="n">addImpl</span><span class="o">(</span><span class="n">impl</span><span class="o">)</span>

      <span class="n">impls</span><span class="o">.</span><span class="n">foreach</span><span class="o">((</span><span class="n">neighbor</span><span class="k">:</span> <span class="kt">Impl</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">neighbor</span><span class="o">.</span><span class="n">uses</span><span class="o">(</span><span class="n">impl</span><span class="o">.</span><span class="n">methodProvided</span><span class="o">))</span> <span class="o">{</span>
          <span class="c1">// Take the neighbor, like `getByIndex &lt;- getFirst + n * getNext`
</span>          <span class="c1">// and see if it can be used -- in this case, seeing whether you have
</span>          <span class="c1">// a time for both getFirst and getNext. If so, push it to the queue.
</span>
          <span class="c1">// this can return multiple things in the case of parameterized Impls
</span>          <span class="n">neighbor</span><span class="o">.</span><span class="n">bind</span><span class="o">(</span><span class="n">result</span><span class="o">).</span><span class="n">map</span><span class="o">((</span><span class="n">boundNeighbor</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="n">implIsUseful</span><span class="o">(</span><span class="n">boundNeighbor</span><span class="o">))</span> <span class="o">{</span>
              <span class="n">queue</span><span class="o">.</span><span class="n">push</span><span class="o">(</span><span class="n">boundNeighbor</span><span class="o">)</span>
            <span class="o">}</span>
          <span class="o">})</span>
        <span class="o">}</span>
      <span class="o">})</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="n">result</span>
<span class="o">}</span>
</code></pre>
</div>

<p>The <code class="highlighter-rouge">bind</code> method of Impl only returns a <code class="highlighter-rouge">Some</code> if it can substitute out all the free variables in the right hand side of the Impl. For example, <code class="highlighter-rouge">bind</code> will return <code class="highlighter-rouge">getByIndex &lt;- n</code> when called on <code class="highlighter-rouge">getByIndex &lt;- getFirst + n * getNext</code> with a result set containing <code class="highlighter-rouge">getFirst &lt;- 1</code> and <code class="highlighter-rouge">getNext &lt;- 1</code>. But it will never return something like <code class="highlighter-rouge">getByIndex &lt;- getFirst + n</code>.</p>

<p>For non-parameterized Impls, there is always a fastest way of doing them. This isn’t true for parameterized Impls, because different implementations might have different conditions and costs which don’t strictly dominate each other. For example, the Impls</p>

<div class="highlighter-rouge"><pre class="highlight"><code>foo[f] if f.bar &lt;- 1
foo[f] if f.baz &lt;- 1
foo[f] &lt;- n
foo[f] &lt;- f
</code></pre>
</div>

<p>are all useful in different situations, so we want to return all of them.</p>

<p>(In practice, I haven’t needed to use this expressiveness very often, and it does make my code much more complicated. So I think I might regret adding it. I’m not sure yet. Certainly it’s useful to be able to pass conditions around, I’m not so sure it’s important to be able to refer to bound variables in the RHS of your Impl.)</p>

<h4 id="composing-data-structures">Composing data structures</h4>

<p>When you have a composite data structure, you only have to run your read methods on one of the data structures, but you have to run your write methods on all of them.</p>

<p>However, the write methods of one data structure can rely on read methods of another. Consider again the single Int which we can use to maintain the sum of a list. On its own, it doesn’t support deletion methods like <code class="highlighter-rouge">deleteLast</code>. But if it is paired with an ArrayList, it can use the <code class="highlighter-rouge">getLast</code> method of the ArrayList to find out what it needs to subtract.</p>

<p>So we end up with code approxiately like this (<a href="https://github.com/bshlgrs/data-structure-composer/blob/d18a104400e214e589cefb72f8d466b97ae44c5f/src/main/scala/implementationSearcher/Searcher.scala#L83-L103">real version here</a>):</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="n">getAllTimesForDataStructures</span><span class="o">(</span><span class="n">dataStructures</span><span class="k">:</span> <span class="kt">Set</span><span class="o">[</span><span class="kt">DataStructure</span><span class="o">])</span><span class="k">:</span> <span class="kt">MethodTimes</span> <span class="o">=</span> <span class="o">{</span>
  <span class="c1">// for the read methods, union everything provided by the data structures
</span>  <span class="c1">// with the defaultReadImpls, then search for times with it
</span>  <span class="k">val</span> <span class="n">allReadTimes</span> <span class="k">=</span> <span class="n">getAllTimes</span><span class="o">(</span><span class="n">dataStructures</span><span class="o">.</span><span class="n">flatMap</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">readImpls</span><span class="o">)</span> <span class="o">++</span> <span class="n">defaultReadImpls</span><span class="o">)</span>

  <span class="c1">// calculate all write times separately
</span>  <span class="k">val</span> <span class="n">writeTimesForDataStructures</span> <span class="k">=</span> <span class="n">dataStructures</span><span class="o">.</span><span class="n">flatMap</span><span class="o">((</span><span class="n">ds</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="o">{</span>
    <span class="n">getAllTimes</span><span class="o">(</span><span class="n">ds</span><span class="o">.</span><span class="n">writeImpls</span> <span class="o">++</span> <span class="n">allReadTimes</span><span class="o">)</span>
  <span class="o">})</span>

  <span class="c1">// add them to each other
</span>  <span class="k">val</span> <span class="n">overallWriteTimes</span> <span class="k">=</span> <span class="n">writeTimesForDataStructures</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reduce</span><span class="o">(</span><span class="k">_</span> <span class="n">leastUpperBound</span> <span class="k">_</span><span class="o">)</span>

  <span class="n">allReadTimes</span> <span class="o">++</span> <span class="n">overallWriteTimes</span>
<span class="o">}</span>
</code></pre>
</div>

<p>And now we can find optimally fast composite data structures!</p>

<p>Parameterizated data structures work very nicely with this, albeit in a slightly counterintuitive way. Basically, during the search we ignore the fact that an <code class="highlighter-rouge">InvertibleReductionMemoizer[f]</code> has to actually choose a single value of <code class="highlighter-rouge">f</code>; we let everyone use the <code class="highlighter-rouge">reduce[f]</code> Impl without reservation. At the end of the search, we can figure out how many different instances of <code class="highlighter-rouge">InvertibleReductionMemoizer</code> we actually need: perhaps we need one for <code class="highlighter-rouge">getSum</code> and one for <code class="highlighter-rouge">getXor</code> or whatever other implementation we wanted to memoize. The number of instances of a data structure that we require only affects our write times by a constant multiple, so it’s irrelevant for the search we’re doing here.</p>

<p>The main other complexity is that the search needs to maintain its paths: we want to be able to know which data structures were used for which methods. This is maintained by storing this source information and passing it around with the Impls throughout.</p>

<h3 id="optimizations">Optimizations</h3>

<p>One obvious problem with this is that there are exponentially many potential composite data structures to look at. So I use some simple heuristics to cut down the number of composite data structures that I actually consider.</p>

<p>Firstly, data structures are only considered if they have a read method which could plausibly help with the implementation of one of the read methods in the ADT. “Could plausibly help” is determined by considering the directed graph formed by turning an Impl like <code class="highlighter-rouge">f &lt;- g + h</code> into the edges <code class="highlighter-rouge">g -&gt; f</code> and <code class="highlighter-rouge">h -&gt; f</code>–if there’s a path in that graph from <code class="highlighter-rouge">x</code> to <code class="highlighter-rouge">y</code>, a data structure providing <code class="highlighter-rouge">x</code> could plausibly help with an ADT requiring <code class="highlighter-rouge">y</code>. This usually cuts off half of the 15-or-so data structures I have, which makes things like 50 times faster. <a href="https://github.com/bshlgrs/data-structure-composer/blob/d18a104400e214e589cefb72f8d466b97ae44c5f/src/main/scala/implementationSearcher/ImplLibrary.scala#L55">This logic lives here.</a></p>

<p>Secondly, when searching through subsets, if I figure out method times for the set of data structures <script type="math/tex">\{A, B, C\}</script> and I’m considering looking at the set <script type="math/tex">\{A, B, C, D\}</script>, I look at whether any of the Impls provided by <script type="math/tex">D</script> are useful given the result of <script type="math/tex">\{A, B, C\}</script>. If not I don’t explore any subsets including all of <script type="math/tex">\{A, B, C, D\}</script>. <a href="https://github.com/bshlgrs/data-structure-composer/blob/d18a104400e214e589cefb72f8d466b97ae44c5f/src/main/scala/implementationSearcher/Searcher.scala#L118-L119">Here’s the source</a>. This makes things a few times faster.</p>

<p>I also cache results of calls to <code class="highlighter-rouge">getAllTimes</code>. If I’ve established that the read method <code class="highlighter-rouge">foo</code> takes <script type="math/tex">\log(n)</script> time for the set <script type="math/tex">\{A, B, C\}</script>, then I can immediately put the Impl <code class="highlighter-rouge">foo &lt;- log(n)</code> into the queue when running the search on <script type="math/tex">\{A, B, C, D\}</script>. I am not sure if this improves efficiency.</p>

<h2 id="deployment">Deployment</h2>

<p>The code is deployed as a Finagle server with a React app in front. The React app can display useful information about the internals of composite data structures.</p>

<p>I tried compiling my search code to ScalaJS, but it was too slow to be a pleasant experience. If my code was like 10x faster it would be alright.</p>

<h2 id="further-work">Further work</h2>

<p>Here are things I want to do:</p>

<ul>
  <li>Generate real code. The result already has all the information we need to generate code, I just haven’t put in the effort to make it work yet.</li>
  <li>Acquire users. I plan to use this to answer lots of questions on Quora etc, to get people to look at it, and hopefully people will start using it more regularly.</li>
  <li>Consider other optimizations. I added in a bunch of cruft in the final push before the conference presentation, and it’s possible that some refactoring might speed things up.</li>
  <li>Distinguish between different concepts like average case time, worst case time, and amortized time.</li>
  <li>Instead of minimizing asymptotic time, I could instead get an empirical measure of the speed of different methods in different data structures, and choose the fastest data structures for a given expected data set size using those measurements. This works best with the approach where we are generating real code with real data structure implementations.</li>
  <li>Extend to talk about other types of queries. In particular, I could try to support more SQL-style queries on multi-column data.</li>
</ul>

<h2 id="conclusion">Conclusion</h2>

<p>How useful could a tool like this be? I don’t know. A lot of data structure research can’t yet be fit nicely into the framework of things I can describe with this system.</p>

<p>I also find that writing data structures down for this project forced me to think about them and write down facts about them that aren’t usually said. For example, the <a href="http://www.geeksforgeeks.org/range-minimum-query-for-static-array/">sparse table</a> data structure for <a href="https://en.wikipedia.org/wiki/Range_minimum_query">range minimum query</a> is usually not described as letting you push things on the end in amortized <script type="math/tex">O(\log(n))</script>, even though you can obviously do that by resizing exponentially. This forced clarity is really useful.</p>

<p>Overall the practical usefulness of this project remains to be seen. It was a lot of fun to build though.</p>

<p>Thanks heaps to everyone who helped me out as I was writing this.</p>

    </div>
  </div>

  <div class="buck-post">
    <h2><a href="/2016/10/23/poor-college-graduates.html"> Poor college graduates do much better than rich high-school dropouts</a></h2>

    <p class="post-meta"><time datetime="2016-10-23T00:00:00-07:00" itemprop="datePublished">Oct 23, 2016</time></p>

    <div class="shrink-headings">
      <p><a href="https://www.washingtonpost.com/news/wonk/wp/2014/10/18/poor-kids-who-do-everything-right-dont-do-better-than-rich-kids-who-do-everything-wrong/">This article from 2014</a>, with the provocative title “Poor kids who do everything right don’t do better than rich kids who do everything wrong” is terrible. It makes a shitty and misleading graph, and makes a variety of nonsensical judgements based on it.</p>

<p>The graph used makes it really hard to see what the actual distributions of overall income are. If you make, say, a bar graph of the income distributions, you’ll see that poor college grads do much better than rich high school dropouts. I made such a graph (<a href="https://docs.google.com/spreadsheets/d/112K9ejdFQMPcnvEqERT2k2Oe7Tk7zJ-YHFuA3LikFRA/edit?usp=sharing">here’s the spreadsheet</a>):</p>

<p><img src="/img/poor-college-grads.png" alt="Bar chart" /></p>

<p>I also estimated the average incomes of both groups based on the given statistics, and found an average income of $78k for the poor college grads and $60k for the rich high school dropouts.</p>

<p>The main piece of evidence that this blog post uses to support its thesis is: “Specifically, rich high school dropouts remain in the top about as much as poor college grads stay stuck in the bottom — 14 versus 16 percent, respectively. Not only that, but these low-income strivers are just as likely to end up in the bottom as these wealthy ne’er-do-wells. Some meritocracy.”</p>

<p>The first of these statistics is not clearly related to meritocracy. If you want high income mobility, you want both these numbers to be low. The sentence is phrased as if it’s bad that the numbers are similar; that doesn’t make sense.</p>

<p>The second of these statistics is correctly interpreted, but seems cherry-picked: I could just as easily point out that 41% of poor college grads end up in the top 40% of income, while only 19% of rich high school dropouts do. To prevent such cherry-picking, we should probably use the Schelling point summary statistics like mean income or median income, both of which indicate that the poor college grads are doing <em>significantly</em> better.</p>

<p>As far as I can tell, the original paper didn’t do anything wrong, this “reporter” just decided to make up some bullshit conclusions from the statistics. This is even worse than most reporting–the mistake isn’t something you have to read the original source to find, the mistake is right there in the graph that Facebook is suggesting as the image preview. Alas!</p>

    </div>
  </div>

  <div class="buck-post">
    <h2><a href="/2016/10/20/libertarians.html"> Left-libertarianism</a></h2>

    <p class="post-meta"><time datetime="2016-10-20T00:00:00-07:00" itemprop="datePublished">Oct 20, 2016</time></p>

    <div class="shrink-headings">
      <p>I know a lot of people who identify as left-libertarians, or bleeding-heart libertarians, or whatever. Scott argued for this position <a href="slatestarcodex.com/2013/12/08/a-something-sort-of-like-left-libertarianism-ist-manifesto/">here</a>. Gary Johnson has <a href="http://bleedingheartlibertarians.com/wp-content/uploads/2016/07/GaryJohnson1-1.jpg">posed wearing a Bleeding Heart Libertarians shirt</a>. A lot of rationalists and EAs seem to think of this as the political position of utilitarians who are aware of the benefits of free markets but also the costs of externalities and inequality.</p>

<p>I don’t think that these people realize how much their values conflict with classic libertarianism. Most importantly, if you’re one of those EA left-libertarians, you should AFAICT probably support way more redistribution than we currently see, and you would probably overall prefer to expand the total share of GDP controlled by the government.</p>

<p>I’m like 70% sure that from a utilitarian perspective which is just optimizing for the short-term welfare of humans and not particularly other animals or the far future, you want to increase redistribution. This guess is based on looking at the US federal budget and noting that a lot of the money goes to direct transfers or various public services. If you kill all of the government spending libertarians don’t like and then increase redistribution as much as utilitarians would probably want to, I suspect that government spending would get bigger overall. This isn’t even including the possibility of redistribution to other countries–if we’re allowed to do that, I think that government would be way bigger than it is now.</p>

<p>Most libertarians would definitely not be cool with this. Given this redistribution preference, it’s not clear to me that the utilitarian left-libertarian position is closer to the Libertarian party than the Democrat party.</p>

<p>This all assumes that I’m right that we should have more income redistribution. But even if we should only have current levels of redistribution, libertarians probably aren’t on board with a future with tax rates as high as they currently are.</p>

<p>Why do EA left-libertarians identify so closely with libertarians? I think it’s a few things—they haven’t thought about the extent of optimal redistribution, they find libertarianism aesthetically appealing and less ideologically grating than leftism or conservatism. There are also some topics where many libertarians and utilitarians get along pretty well–most of the support for the Open Borders movement seems to come from libertarians. But I think it’s more based on aesthetic preferences than actual policy alignment.</p>

<hr />

<p><a href="https://www.facebook.com/bshlgrs/posts/10208902535175381">view comments on Facebook</a></p>

    </div>
  </div>


<p><a href="/posts">All posts</a></p>

<p><a href="/feed.xml">RSS feed</a></p>

<script>
$(function() {
  $(".shrink-headings").map(function(idx, div) {
    $(div).html(
      $(div)
        .html()
        .replace(/<h4/g, "<h5")
        .replace(/<h3/g, "<h4")
        .replace(/<h2/g, "<h3")
    )
  })
})
</script>


      <hr/>

      <div class="PageNavigation">
        
        
      </div>

    </div>

    <div class="col-sm-3 visible-xs-block">
      <img src="/img/dual_n_buck.jpeg" class="img-responsive" alt="Picture of Buck" height="213" width="213">
<hr/>
<a class="arrow" href="/"><strong>Buck</strong></a>
<ul>
  <li><a class="arrow" href="/about">About</a>
    <ul>
      <li><a href="http://triplebyte.com?ref=shlegeris.com">Triplebyte</a></li>
    </ul>
  </li>
  <li>Links
    <ul>
      <li>
          <a class="arrow" href="http://github.com/bshlgrs">GitHub</a>
      </li>
      <li>
          <a class="arrow" href="mailto:bshlegeris@gmail.com">Email</a>
      </li>
      <li>
          <a class="arrow" href="http://www.facebook.com/bshlgrs">Facebook</a>
      </li>
      <li>
          <a class="arrow" href="http://lnkd.in/bnBJ6EF">LinkedIn</a>
      </li>
    </ul>
  </li>
  <li><a class="arrow external" href="/anonymous_feedback">Anonymous feedback</a></li>
  <li>Software to play with
    <ul>
      <li>
          <a class="arrow" href="https://bshlgrs.github.io/music-game/">Relative pitch game</a>
      </li>
      <li>
          <a class="arrow" href="http://shlegeris.com/gini">Gini coefficient tool</a>
      </li>
      <li>
          <a class="arrow" href="http://shlegeris.com/dice">Extremely serious election probability tool</a>
      </li>
    </ul>
  </li>
  <li><a href="/posts" class="arrow">Blog</a> (<a href="/best" class="arrow">Best posts</a>) (<a href="/feed.xml">RSS</a>)
    <ul>
      
        <li>
          <a class="arrow" href="/2016/11/13/ds.html">Building a search engine for data structures</a>
        </li>
      
        <li>
          <a class="arrow" href="/2016/10/23/poor-college-graduates.html">Poor college graduates do much better than rich high-school dropouts</a>
        </li>
      
        <li>
          <a class="arrow" href="/2016/10/20/libertarians.html">Left-libertarianism</a>
        </li>
      
        <li>
          <a class="arrow" href="/2016/10/07/optimal-tax.html">Optimal redistribution with a flat tax</a>
        </li>
      
        <li>
          <a class="arrow" href="/2016/10/02/ubi.html">Universal basic incomes disincentivise work</a>
        </li>
      
        <li>
          <a class="arrow" href="/2016/10/02/tax.html">The great thing about regressive taxes</a>
        </li>
      
        <li>
          <a class="arrow" href="/2016/09/27/wages.html">Contradictory claims in labor economics</a>
        </li>
      
        <li>
          <a class="arrow" href="/2016/09/24/cato.html">A mistake in the Cato institute report on risks from refugees</a>
        </li>
      
    </ul>
  </li>
  <li>
      <a class="arrow" href="/to-prove-list">My "to-prove" list</a>
  </li>
  <li>
      <a class="arrow" href="/mistakes">Mistakes</a>
  </li>
  <li>
      <a class="arrow" href="/cute">Pictures of me</a>
  </li>
</ul>

    </div>
  </div>
</div>




    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">Buck Shlegeris</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>Buck Shlegeris</li>
          <li><a href="mailto:bshlegeris@gmail.com">bshlegeris@gmail.com</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/bshlgrs"><span class="icon icon--github"><svg viewBox="0 0 16 16"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">bshlgrs</span></a>

          </li>
          

          
          <li>
            <a href="https://twitter.com/bshlgrs"><span class="icon icon--twitter"><svg viewBox="0 0 16 16"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg>
</span><span class="username">bshlgrs</span></a>

          </li>
          
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>Website of Buck Shlegeris.
</p>
      </div>
    </div>

  </div>

</footer>


  </body>
<script>
if (window.location.hostname == "bshlgrs.github.io") {
  window.location.hostname = "shlegeris.com";
}
</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-52980069-1', 'auto');
  ga('send', 'pageview');

</script>

</html>

